<script>
function hashValue(str){
  return str.split("").reduce((a,b)=>a+b.charCodeAt(0),0);
}

function convertToAPI(ref){
  return ref
    // PL
    .replace(/^Mazmur/, "Psalm")
    .replace(/^Amsal/, "Proverbs")
    .replace(/^Yesaya/, "Isaiah")

    // Injil
    .replace(/^Matius/, "Matthew")
    .replace(/^Markus/, "Mark")
    .replace(/^Lukas/, "Luke")
    .replace(/^Yohanes/, "John")

    // Kisah & Surat
    .replace(/^Kisah Para Rasul/, "Acts")
    .replace(/^Roma/, "Romans")
    .replace(/^1 Korintus/, "1 Corinthians")
    .replace(/^2 Korintus/, "2 Corinthians")
    .replace(/^Galatia/, "Galatians")
    .replace(/^Efesus/, "Ephesians")
    .replace(/^Filipi/, "Philippians")
    .replace(/^Kolose/, "Colossians")
    .replace(/^1 Tesalonika/, "1 Thessalonians")
    .replace(/^2 Tesalonika/, "2 Thessalonians")
    .replace(/^1 Timotius/, "1 Timothy")
    .replace(/^2 Timotius/, "2 Timothy")
    .replace(/^Titus/, "Titus")
    .replace(/^Ibrani/, "Hebrews")
    .replace(/^Yakobus/, "James")
    .replace(/^1 Petrus/, "1 Peter")
    .replace(/^2 Petrus/, "2 Peter")
    .replace(/^1 Yohanes/, "1 John")
    .replace(/^2 Yohanes/, "2 John")
    .replace(/^3 Yohanes/, "3 John")
    .replace(/^Wahyu/, "Revelation");
}

let lastText="";

function getVerse(){
  const name=document.getElementById("name").value.trim();
  if(!name) return;

  const today=new Date().toISOString().slice(0,10);
  const idx=hashValue(name+today)%referencesLAI.length;

  const refLAI = referencesLAI[idx];   // referensi Indonesia
  const refAPI = convertToAPI(refLAI); // untuk API

  fetch("https://bible-api.com/"+encodeURIComponent(refAPI)+"?translation=kjv")
    .then(r=>r.json())
    .then(d=>{
      if(!d.text){
        document.getElementById("result").innerHTML =
          "<strong>"+refLAI+"</strong><br><br>(Ayat tidak tersedia)";
        return;
      }

      lastText = refLAI + "\n\n" + d.text;

      document.getElementById("result").innerHTML =
        "<strong>"+refLAI+"</strong><br><br>" +
        d.text +
        "<br><br><small><em>Version: KJV</em></small>";

      document.getElementById("actions").style.display="block";
    });
}

function copyVerse(){
  navigator.clipboard.writeText(lastText);
  alert("Ayat berhasil disalin");
}

function shareWA(){
  window.open("https://wa.me/?text="+encodeURIComponent(lastText));
}
</script>
