<script>
document.addEventListener("DOMContentLoaded",()=>{

const verses=[{
  ref:"Roma 8:28",
  text:"Kita tahu bahwa Allah turut bekerja dalam segala sesuatu untuk mendatangkan kebaikan bagi mereka yang mengasihi Dia."
}];

const verse = verses[0];
let shuffle=null,lastText="",lastName="";

const name=document.getElementById("name");
const startBtn=document.getElementById("startBtn");
const displayName=document.getElementById("displayName");
const result=document.getElementById("result");
const hint=document.getElementById("hint");
const tapArea=document.getElementById("tapArea");
const actions=document.getElementById("actions");
const canvas=document.getElementById("canvas");

startBtn.onclick=()=>{
  lastName=name.value.trim();
  if(!lastName) return;

  name.style.display="none";
  startBtn.style.display="none";

  displayName.innerText=lastName;
  displayName.style.display="block";

  result.style.display="block";
  hint.style.display="block";
  tapArea.style.display="block";

  result.innerHTML=`<strong>${verse.ref}</strong><br><br>${verse.text}`;

  shuffle=setInterval(()=>{
    result.innerHTML=`<strong>${verse.ref}</strong><br><br>${verse.text}`;
  },80);
};

tapArea.onclick=()=>{
  clearInterval(shuffle);

  result.innerHTML=`<strong>${verse.ref}</strong><br><br>${verse.text}`;
  lastText=verse.ref+"\n\n"+verse.text;

  tapArea.style.display="none";
  hint.style.display="none";
  actions.style.display="block";
};

window.copyVerse=()=>{
  navigator.clipboard.writeText(lastText);
};

window.shareAsImage=()=>{
  const ctx=canvas.getContext("2d");
  canvas.width=1080;
  canvas.height=1920;

  const bg=new Image();
  bg.src="background.jpeg";
  const logo=new Image();
  logo.src="logo.png";

  bg.onload=()=>{
    const r=Math.max(1080/bg.width,1920/bg.height);
    ctx.drawImage(bg,(1080-bg.width*r)/2,(1920-bg.height*r)/2,bg.width*r,bg.height*r);

    logo.onload=()=>{
      ctx.drawImage(logo,(1080-180)/2,420,180,180);

      ctx.fillStyle="#fff";
      ctx.textAlign="left";
      ctx.shadowColor="rgba(0,0,0,.6)";
      ctx.shadowBlur=6;

      ctx.font="bold 56px Arial";
      ctx.fillText(lastName,120,820);

      ctx.font="46px Arial";
      wrapText(ctx,lastText,120,900,840,64);

      canvas.toBlob(b=>{
        navigator.share({
          files:[new File([b],"ayat.png",{type:"image/png"})]
        });
      });
    };
  };
};

function wrapText(ctx,text,x,y,w,h){
  let line="";
  text.split(" ").forEach(word=>{
    const test=line+word+" ";
    if(ctx.measureText(test).width>w){
      ctx.fillText(line,x,y);
      line=word+" ";
      y+=h;
    }else line=test;
  });
  ctx.fillText(line,x,y);
}

});
</script>
